{{- $quizId := .quizId -}}
{{- $quizData := .quizData -}}

<div class="quiz-container" id="{{ $quizId }}" data-quiz-id="{{ $quizId }}">
  <div class="quiz-header">
    <h3>{{ $quizData.title | default "Quiz" }}</h3>
    {{- if $quizData.description -}}
    <p class="quiz-description">{{ $quizData.description }}</p>
    {{- end -}}
  </div>

  <div class="quiz-progress">
    <div class="quiz-progress-main">
      <span class="progress-text">Question <span class="current-question">1</span> of <span class="total-questions">{{ len $quizData.questions }}</span></span>
      <span class="answered-count">(<span class="answered-number">0</span> answered)</span>
    </div>
    <button class="quiz-review-past-btn" type="button">Review Past Incorrect</button>
  </div>

  <div class="quiz-content">
    {{- range $qIndex, $question := $quizData.questions -}}
    <div class="quiz-question" data-question-index="{{ $qIndex }}" data-question-id="{{ $question.id | default (printf "%s-%d" $quizId $qIndex) }}" data-question-type="{{ $question.type }}" style="display: {{ if eq $qIndex 0 }}block{{ else }}none{{ end }};">
      <div class="question-header">
        <span class="question-number">Question {{ add $qIndex 1 }}</span>
      </div>

      <div class="question-text">{{ $question.question | markdownify }}</div>

      {{- if eq $question.type "mcq" -}}
        {{- partial "quiz/mcq.html" $question -}}
      {{- else if eq $question.type "multiple-select" -}}
        {{- partial "quiz/multiple-select.html" $question -}}
      {{- else if eq $question.type "true-false" -}}
        {{- partial "quiz/true-false.html" $question -}}
      {{- else if eq $question.type "fill-blank" -}}
        {{- partial "quiz/fill-blank.html" $question -}}
      {{- else if eq $question.type "code-output" -}}
        {{- partial "quiz/code-output.html" $question -}}
      {{- else if eq $question.type "flashcard" -}}
        {{- partial "quiz/flashcard.html" $question -}}
      {{- else if eq $question.type "drag-drop" -}}
        {{- partial "quiz/drag-drop.html" $question -}}
      {{- else if eq $question.type "code-completion" -}}
        {{- partial "quiz/code-completion.html" $question -}}
      {{- end -}}

      <div class="question-feedback" style="display: none;">
        <div class="feedback-correct" style="display: none;">
          <span class="feedback-icon">‚úì</span>
          <span class="feedback-text">Correct!</span>
          {{- if $question.explanation -}}
          <p class="explanation">{{ $question.explanation | markdownify }}</p>
          {{- end -}}
        </div>
        <div class="feedback-incorrect" style="display: none;">
          <span class="feedback-icon">‚úó</span>
          <span class="feedback-text">Incorrect</span>
          {{- if $question.explanation -}}
          <p class="explanation">{{ $question.explanation | markdownify }}</p>
          {{- end -}}
        </div>
      </div>

      {{- if $question.hint -}}
      <button class="hint-button" type="button">üí° Show Hint</button>
      <div class="hint-content" style="display: none;">{{ $question.hint | markdownify }}</div>
      {{- end -}}

      <div class="question-actions">
        <button class="submit-answer-btn" type="button">Submit Answer</button>
      </div>
    </div>
    {{- end -}}
  </div>

  <div class="quiz-navigation">
    <button class="quiz-prev-btn" type="button" disabled>‚Üê Previous</button>
    <button class="quiz-next-btn" type="button">Next ‚Üí</button>
  </div>

  <div class="quiz-footer">
    <button class="quiz-reset-btn" type="button" style="display: none;">Reset Quiz</button>
  </div>

  <div class="quiz-results" style="display: none;">
    <h4>Quiz Results</h4>
    <div class="results-summary">
      <div class="results-card">
        <div class="result-label">Score</div>
        <div class="result-value score-fraction"><span class="correct-count">0</span>/<span class="total-count">0</span></div>
      </div>
      <div class="results-card">
        <div class="result-label">Accuracy</div>
        <div class="result-value score-value">0%</div>
      </div>
      <div class="results-card">
        <div class="result-label">Right</div>
        <div class="result-value right-count">0</div>
        <div class="result-label">Wrong</div>
        <button class="result-value wrong-count" type="button" aria-label="Copy incorrect questions list">0</button>
        <div class="incorrect-copy-status" aria-live="polite"></div>
        <div class="result-label">Skipped</div>
        <div class="result-value skipped-count">0</div>
      </div>
    </div>
    <button class="quiz-review-incorrect-btn" type="button" style="display: none;">Review Incorrect Questions</button>
  </div>
</div>

<script type="application/json" class="quiz-data" data-for="{{ $quizId }}">
{{- $quizData | jsonify -}}
</script>
